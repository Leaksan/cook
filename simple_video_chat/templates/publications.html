{% extends "base.html" %} {% block title %}Vidéos - The Sauce{% endblock %} {%
block content %}
<div class="page-header">
    <h1>
        <i class="fas fa-video"></i>
        Vidéos
    </h1>
    {% if session.get('username') %}
    <a href="{{ url_for('upload') }}" class="btn btn-primary">
        <i class="fas fa-cloud-upload-alt"></i>
        Publier une vidéo
    </a>
    {% endif %}
</div>

<!-- Category Filter -->
<div class="card mb-4">
    <div class="d-flex gap-2 align-center" style="flex-wrap: wrap">
        <span class="text-muted"><i class="fas fa-filter"></i> Filtrer :</span>
        <a
            href="{{ url_for('publications') }}"
            class="btn {% if not current_category %}btn-primary{% else %}btn-outline{% endif %} btn-sm"
        >
            Toutes
        </a>
        {% for cat in categories %}
        <a
            href="{{ url_for('publications', category=cat) }}"
            class="btn {% if current_category == cat %}btn-primary{% else %}btn-outline{% endif %} btn-sm"
        >
            {{ cat }}
        </a>
        {% endfor %}
    </div>
</div>

{% if current_category %}
<div class="alert alert-info mb-4">
    <i class="fas fa-folder"></i>
    Catégorie : <strong>{{ current_category }}</strong>
    <a
        href="{{ url_for('publications') }}"
        style="margin-left: 1rem"
        class="btn btn-sm btn-outline"
    >
        <i class="fas fa-times"></i> Effacer le filtre
    </a>
</div>
{% endif %} {% if publications %}
<div class="videos-grid">
    {% for pub in publications %}
    <div class="video-card">
        <a href="{{ url_for('watch', pub_id=pub.id) }}">
            <div class="video-thumbnail">
                <video preload="metadata" muted>
                    <source
                        src="{{ url_for('static', filename='uploads/' + pub.filename) }}#t=0.5"
                        type="video/mp4"
                    />
                </video>
                <div class="video-play-overlay">
                    <i class="fas fa-play-circle"></i>
                </div>
            </div>
        </a>
        <div class="video-info">
            <a href="{{ url_for('watch', pub_id=pub.id) }}">
                <h3 class="video-title">{{ pub.title }}</h3>
            </a>
            {% if pub.category %}
            <a
                href="{{ url_for('publications', category=pub.category) }}"
                class="badge badge-primary"
                style="font-size: 0.7rem; margin-bottom: 0.5rem"
            >
                <i class="fas fa-folder"></i> {{ pub.category }}
            </a>
            {% endif %}
            <div class="video-meta">
                <a
                    href="{{ url_for('view_user', username=pub.username) }}"
                    class="video-author"
                >
                    <div
                        class="user-avatar-placeholder"
                        style="width: 24px; height: 24px; font-size: 0.7rem"
                    >
                        <i class="fas fa-user"></i>
                    </div>
                    <span>{{ pub.username }}</span>
                </a>
                <div class="video-stats">
                    <span title="Vues">
                        <i class="fas fa-eye"></i>
                        {{ pub.views }}
                    </span>
                    <span title="J'aime">
                        <i class="fas fa-heart"></i>
                        {{ pub.likes }}
                    </span>
                </div>
            </div>
            <p class="text-muted mt-1" style="font-size: 0.75rem">
                <i class="fas fa-calendar"></i>
                {{ pub.created_at.strftime('%d/%m/%Y') }}
            </p>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <i class="fas fa-film"></i>
    {% if current_category %}
    <h3>Aucune vidéo dans cette catégorie</h3>
    <p class="text-muted">
        Il n'y a pas encore de vidéos dans la catégorie "{{ current_category
        }}".
    </p>
    <a href="{{ url_for('publications') }}" class="btn btn-outline mt-2">
        <i class="fas fa-arrow-left"></i>
        Voir toutes les vidéos
    </a>
    {% else %}
    <h3>Aucune vidéo pour le moment</h3>
    <p class="text-muted">
        Soyez le premier à partager une vidéo avec la communauté !
    </p>
    {% if session.get('username') %}
    <a href="{{ url_for('upload') }}" class="btn btn-primary mt-2">
        <i class="fas fa-cloud-upload-alt"></i>
        Publier une vidéo
    </a>
    {% else %}
    <a href="{{ url_for('login') }}" class="btn btn-primary mt-2">
        <i class="fas fa-sign-in-alt"></i>
        Connectez-vous pour publier
    </a>
    {% endif %} {% endif %}
</div>
{% endif %} {% endblock %} {% block scripts %}
<script>
    // Auto-load video thumbnails
    document.querySelectorAll(".video-thumbnail video").forEach((video) => {
        video.addEventListener("loadedmetadata", function () {
            this.currentTime = 0.5;
        });
        video.addEventListener("seeked", function () {
            this.pause();
        });
    });

    // Hover preview
    document.querySelectorAll(".video-card").forEach((card) => {
        const video = card.querySelector("video");
        if (video) {
            card.addEventListener("mouseenter", () => {
                video.play().catch(() => {});
            });
            card.addEventListener("mouseleave", () => {
                video.pause();
                video.currentTime = 0.5;
            });
        }
    });
</script>
{% endblock %}
